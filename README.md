# geo-service

Проект представляет из себя класическое spring-boot приложение, собираемое через maven.

Данные для приложения лежат в src/main/resources. 
<p>
Имеется возможность их перегенерировать с помощью main класса ru.kolpakov.test.geoservice.GeoServiceDataGenerator, 
где можно указать выходную директорию, среднюю ошибку измерения дистанции и количество генерируемых пользователей.
Пользователи распределяются по ячейкам случайным образом.
</p>
<br>
<p>
Для запуска приложения исользуется скрипт launch_script.sh в корне проекта. 
С помощью модификации скрипта можно настроить:
<ul>
<li>порт, на котором стартует приложение(--server.port)</li>
<li>расположение входных данных для таблицы с пользователями(--users.table.path)</li>
<li>расположения входных данных для таблицы с ячейками(--geo.cells.table.path)</li>
<li>уровня логгирования классов приложения (--logging.level.ru.kolpakov.test)</li>
</ul>
Файлы входных данных для таблиц должны представлять из себя csv файл с разделителем ";" и без заголовков, и столбцами id, lon, lat для таблицы пользователей, 
и столбцами lon, lat, distanceError для таблицы ячеек.
</p>
<p>
Приложение предоставляет 4 метода в HTTP API:
<ul>
<li>GET /cell_stat?lon=${lon}&lat=${lat} для определения количества узлов в ячейке</li>
<li>PUT /user_label/${id} -d '{"lon":${lon}, "lat":${lat}}'для добавления и обновления метки пользователя</li>
<li>DELETE /user_label/${id} для удаления метки пользователя</li>
<li>GET /placement?id=${id}&lon=${lon}&lat=${lat} определения, находится ли пользователь рядом с меткой</li>
</ul>
<p>
Приложение считывает входные данные для таблиц при запуске. 
Основной класс приложения(реализация логики хранения): ru.kolpakov.test.geoservice.storage.GeoStorage.
Поля класса представляют собой индексы по координатам для ячеек и по айди для пользователей.
Все операции работы с метками пользователей(обновление, удаление, расчет нахождения рядом с меткой) захватывают блокировку на запись(id записи) 
с которой они будут работать для корректного, потоко-безопасного выполнения.
Для определения количества узлов в ячейке для каждого узла ведется атомарный счетчик узлов.
</p>
